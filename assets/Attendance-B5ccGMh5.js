import{r as q,j as r}from"./react-vendor-C8iBsMnn.js";import{x as m}from"./xlsx-vendor-ojjeZmMj.js";import{c as ee}from"./cadetService-BXy_--2f.js";import{c as J,f as ce}from"./attendanceService-BpGXN45O.js";import"./vendor-C6jWcdt9.js";import"./firebase-vendor-u2jlvS72.js";import"./index-DKB6D4ej.js";function te(s,h){const l=[],u=new Date(s);for(;u<=h;){const t=u.getFullYear(),y=String(u.getMonth()+1).padStart(2,"0"),x=String(u.getDate()).padStart(2,"0");l.push(`${t}-${y}-${x}`),u.setDate(u.getDate()+1)}return l}function _(s){const[h,l,u]=s.split("-").map(Number);return new Date(h,l-1,u).getDay()}function G(s){const[h,l,u]=s.split("-").map(Number),t=new Date(h,l-1,u),y=t.getDay(),x=y===0?6:y-1;t.setDate(t.getDate()-x);const o=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),p=String(t.getDate()).padStart(2,"0");return`${o}-${i}-${p}`}function ne(s,h){if(!s)return null;switch(_(h)){case 1:return s.ptMonday??null;case 2:return s.ptTuesday??null;case 3:return s.ptWednesday??null;case 4:return s.ptThursday??null;case 5:return s.ptFriday??null;default:return null}}function re(s,h){return s&&_(h)===4?s.labThursday??null:null}function se(s,h,l){return!s||l!=="MS3"?null:_(h)===2?s.tacticsTuesday??null:null}function ie(s,h,l,u){const t=m.utils.aoa_to_sheet(s);t["!cols"]=[{wch:20},...l.map(()=>({wch:12})),{wch:15},{wch:15},{wch:15}];const y=m.utils.decode_range(t["!ref"]||"A1");for(let o=0;o<=y.e.c;o++){const i=m.utils.encode_cell({r:0,c:o});t[i]&&(t[i].s={fill:{fgColor:{rgb:"FFD3D3D3"}},font:{bold:!0,sz:12,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}})}const x=new Map;for(let o=1;o<s.length;o++){const i=s[o];if(!i||u.includes(i[0])||i[0]===""||!i[0])continue;const p=i[0].split(", ");if(p.length===2){for(const[F,d]of h)if(d.cadet.lastName===p[0]&&d.cadet.firstName===p[1]){x.set(o,d.dates);break}}}for(let o=1;o<=y.e.r;o++){const i=s[o];if(!i)continue;if(u.includes(i[0])){const d=m.utils.encode_cell({r:o,c:0});t[d]&&(t[d].s={fill:{fgColor:{rgb:"FFD3D3D3"}},font:{bold:!0,sz:12,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}});continue}if(i[0]===""||!i[0])continue;const p=x.get(o);for(let d=1;d<=l.length;d++){const b=m.utils.encode_cell({r:o,c:d});if(!t[b])continue;const a=l[d-1],g=p==null?void 0:p.get(a);g==="present"?t[b].s={fill:{fgColor:{rgb:"FF90EE90"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}:g==="excused"?t[b].s={fill:{fgColor:{rgb:"FFFFFF00"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}:g==="unexcused"?t[b].s={fill:{fgColor:{rgb:"FFFF6B6B"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}:t[b].s={fill:{fgColor:{rgb:"FFFFFFFF"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}}const F=m.utils.encode_cell({r:o,c:0});t[F]&&(t[F].s={alignment:{horizontal:"left",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}});for(let d=l.length+1;d<=y.e.c;d++){const b=m.utils.encode_cell({r:o,c:d});t[b]&&(t[b].s={alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}})}}return t}async function de(){const s=new Date("2026-01-20"),h=new Date("2026-04-23"),l=te(s,h),u=["MS1","MS2","MS3","MS4","MS5"],t=new Map;for(const a of u){const g=await ee(a);g.length>0&&t.set(a,g)}const y=new Set;for(const a of l)y.add(G(a));const x=new Map;for(const a of y){const g=await J(a);x.set(a,g)}const o=m.utils.book_new(),i=l.filter(a=>{const g=_(a);return g===2||g===3||g===4}),p=l.filter(a=>_(a)===4),F=l.filter(a=>_(a)===2),d=[{type:"PT",name:"PT",dates:i},{type:"Lab",name:"Lab",dates:p},{type:"Tactics",name:"Tactics",dates:F}];for(const{type:a,name:g,dates:f}of d){const L=["Name",...f.map(z=>{const[v,k,$]=z.split("-");return`${k}/${$}/${v}`}),"Total Present","Total Excused","Total Unexcused"],P=new Map;for(const[z,v]of t)for(const k of v){if(a==="Tactics"&&k.militaryScienceLevel!=="MS3")continue;const $=new Map;let M=0,E=0,R=0;for(const j of f){const Q=G(j),I=x.get(Q),e=(I==null?void 0:I.get(k.id))??null;let n=null;a==="PT"?n=ne(e,j):a==="Lab"?n=re(e,j):a==="Tactics"&&(n=se(e,j,k.militaryScienceLevel)),$.set(j,n),n==="present"?M++:n==="excused"?E++:n==="unexcused"&&R++}P.set(k.id,{cadet:k,dates:$,totalPresent:M,totalExcused:E,totalUnexcused:R})}const B=[];B.push(L);for(const z of u){const v=t.get(z);if(!v||v.length===0)continue;const k=a==="Tactics"?v.filter(M=>M.militaryScienceLevel==="MS3"):v;if(k.length===0)continue;const $=new Array(L.length).fill("");$[0]=z,B.push($);for(const M of k){const E=P.get(M.id);if(!E)continue;const R=[`${M.lastName}, ${M.firstName}`,...f.map(j=>""),E.totalPresent,E.totalExcused,E.totalUnexcused];B.push(R)}}const K=ie(B,P,f,u);m.utils.book_append_sheet(o,K,g)}const b=`attendance_export_${s.toISOString().split("T")[0]}_to_${h.toISOString().split("T")[0]}.xlsx`;m.writeFile(o,b)}async function ge(){const l=te(new Date("2026-01-20"),new Date("2026-04-23")),t=new Date().toISOString().split("T")[0],y=G(t),[x,o,i]=y.split("-").map(Number),p=new Date(x,o-1,i),F=new Date(p);F.setDate(F.getDate()-7);const d=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}-${String(F.getDate()).padStart(2,"0")}`,b=new Date(p);b.setDate(b.getDate()+1);const a=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}-${String(b.getDate()).padStart(2,"0")}`,g=[];for(let e=0;e<7;e++){const n=new Date(F);n.setDate(n.getDate()+e);const W=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;g.push(W)}const f=g.filter(e=>{const n=_(e);return n===2||n===3||n===4}),L=g.filter(e=>_(e)===4),P=g.filter(e=>_(e)===2),B=[...f,a],K=[...P,a],z=[...L],v=["MS1","MS2","MS3","MS4","MS5"],k=new Map;for(const e of v){const n=await ee(e);n.length>0&&k.set(e,n)}const $=await J(d),M=await J(y),E=new Set;for(const e of l)E.add(G(e));const R=new Map;for(const e of E){const n=await J(e);R.set(e,n)}const j=m.utils.book_new(),Q=[{type:"PT",name:"PT",dates:B,getStatus:(e,n)=>ne(e,n),getSemesterTotal:e=>{if(!e)return 0;let n=0;return(e.ptTuesday==="excused"||e.ptTuesday==="unexcused")&&n++,(e.ptWednesday==="excused"||e.ptWednesday==="unexcused")&&n++,(e.ptThursday==="excused"||e.ptThursday==="unexcused")&&n++,n}},{type:"Lab",name:"Lab",dates:z,getStatus:(e,n)=>re(e,n),getSemesterTotal:e=>e&&(e.labThursday==="excused"||e.labThursday==="unexcused")?1:0},{type:"Tactics",name:"Tactics",dates:K,getStatus:(e,n,W)=>se(e,n,W),getSemesterTotal:e=>e&&(e.tacticsTuesday==="excused"||e.tacticsTuesday==="unexcused")?1:0}];for(const{type:e,name:n,dates:W,getStatus:X,getSemesterTotal:oe}of Q){const H=new Map;for(const[w,S]of k)for(const c of S){if(e==="Tactics"&&c.militaryScienceLevel!=="MS3")continue;const A=$.get(c.id),D=M.get(c.id),O=new Map;let Y=!1;for(const N of W)if(N===a&&!g.includes(N)){const C=X(D,N,c.militaryScienceLevel);(C==="excused"||C==="unexcused")&&(O.set(N,C),Y=!0)}else if(g.includes(N)){const C=X(A,N,c.militaryScienceLevel);(C==="excused"||C==="unexcused")&&(O.set(N,C),Y=!0)}if(Y){let N=0;for(const[C,ae]of R){const le=ae.get(c.id);N+=oe(le)}H.set(c.id,{cadet:c,absences:O,semesterTotalAbsences:N})}}const Z=["Name",...W.map(w=>{const[S,c,A]=w.split("-");return`${c}/${A}/${S}`}),"Total Semester Absences"],U=[];U.push(Z);for(const w of v){const S=k.get(w);if(!S||S.length===0)continue;const c=e==="Tactics"?S.filter(D=>D.militaryScienceLevel==="MS3"&&H.has(D.id)):S.filter(D=>H.has(D.id));if(c.length===0)continue;const A=new Array(Z.length).fill("");A[0]=w,U.push(A);for(const D of c){const O=H.get(D.id);if(!O)continue;const Y=[`${D.lastName}, ${D.firstName}`,...W.map(N=>{const C=O.absences.get(N);return C==="unexcused"?"U":C==="excused"?"E":""}),O.semesterTotalAbsences];U.push(Y)}}const T=m.utils.aoa_to_sheet(U);T["!cols"]=[{wch:20},...W.map(()=>({wch:12})),{wch:20}];const V=m.utils.decode_range(T["!ref"]||"A1");for(let w=0;w<=V.e.c;w++){const S=m.utils.encode_cell({r:0,c:w});T[S]&&(T[S].s={fill:{fgColor:{rgb:"FFD3D3D3"}},font:{bold:!0,sz:12,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}})}for(let w=1;w<=V.e.r;w++){const S=U[w];if(S){if(v.includes(S[0])){const c=m.utils.encode_cell({r:w,c:0});T[c]&&(T[c].s={fill:{fgColor:{rgb:"FFD3D3D3"}},font:{bold:!0,sz:12,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}});continue}for(let c=0;c<=V.e.c;c++){const A=m.utils.encode_cell({r:w,c});if(T[A])if(c>0&&c<=W.length){const D=S[c];D==="U"?T[A].s={fill:{fgColor:{rgb:"FFFF6B6B"}},font:{bold:!0,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}:D==="E"?T[A].s={fill:{fgColor:{rgb:"FFFFFF00"}},font:{bold:!0,color:{rgb:"FF000000"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}:T[A].s={alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}}else T[A].s={alignment:{horizontal:c===0?"left":"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"FF000000"}},bottom:{style:"thin",color:{rgb:"FF000000"}},left:{style:"thin",color:{rgb:"FF000000"}},right:{style:"thin",color:{rgb:"FF000000"}}}}}}}m.utils.book_append_sheet(j,T,n)}const I=`last_week_absences_${d}.xlsx`;m.writeFile(j,I)}const ue=["Alpha","Bravo","Charlie","Ranger","Headquarters Company","Master"];function xe({onBack:s,onSelectCompany:h,onTactics:l,onIssues:u}){const[t,y]=q.useState("companies"),[x,o]=q.useState(!1),[i,p]=q.useState(!1),[F,d]=q.useState(!1);async function b(){o(!0);try{await de(),alert("Attendance exported successfully! The Excel file has been downloaded.")}catch(f){console.error("Error exporting attendance:",f),alert(`Error exporting attendance: ${f instanceof Error?f.message:"Unknown error"}`)}finally{o(!1)}}async function a(){p(!0);try{await ge(),alert("Last week absences exported successfully! The Excel file has been downloaded.")}catch(f){console.error("Error exporting last week absences:",f),alert(`Error exporting last week absences: ${f instanceof Error?f.message:"Unknown error"}`)}finally{p(!1)}}async function g(){if(window.confirm("Are you sure you want to clear all attendance data? This will reset all attendance records to blank (—). This action cannot be undone.")){d(!0);try{await ce(),alert("All attendance data has been cleared successfully.")}catch(L){console.error("Error clearing attendance:",L),alert(`Error clearing attendance: ${L instanceof Error?L.message:"Unknown error"}`)}finally{d(!1)}}}return r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe-area-inset-bottom",children:[r.jsxs("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 safe-area-inset-top",children:[r.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Attendance"}),r.jsx("button",{onClick:s,className:"text-sm text-blue-600 font-medium touch-manipulation min-h-[44px] min-w-[44px]",children:"Back"})]}),r.jsxs("div",{className:"flex border-t border-gray-200",children:[r.jsx("button",{onClick:()=>y("companies"),className:`flex-1 px-4 py-3 text-sm font-medium touch-manipulation min-h-[44px] ${t==="companies"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Companies"}),r.jsx("button",{onClick:u,className:"flex-1 px-4 py-3 text-sm font-medium touch-manipulation min-h-[44px] text-gray-600 hover:text-gray-900",children:"Issues"}),r.jsx("button",{onClick:()=>y("settings"),className:`flex-1 px-4 py-3 text-sm font-medium touch-manipulation min-h-[44px] ${t==="settings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Settings"})]})]}),r.jsxs("main",{className:"px-4 py-4",children:[t==="companies"&&r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"text-center text-gray-600 mb-6",children:"Select a company to handle attendance"}),r.jsxs("div",{className:"space-y-3",children:[ue.map(f=>r.jsx("button",{onClick:()=>h(f),className:"w-full bg-white rounded-lg shadow-sm border border-gray-200 px-6 py-4 text-left hover:bg-gray-50 active:bg-gray-100 transition-colors touch-manipulation min-h-[44px]",children:r.jsx("span",{className:"text-lg font-semibold text-gray-900",children:f==="Master"?"Master List":`${f} Company`})},f)),r.jsx("button",{onClick:l,className:"w-full bg-white rounded-lg shadow-sm border border-gray-200 px-6 py-4 text-left hover:bg-gray-50 active:bg-gray-100 transition-colors touch-manipulation min-h-[44px]",children:r.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Tactics"})})]})]}),t==="settings"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Attendance"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Export attendance data to an Excel spreadsheet. Includes all cadets grouped by MS level with dates from January 20, 2026 to April 23, 2026."}),r.jsx("button",{onClick:b,disabled:x,className:`w-full py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${x?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 active:bg-green-800"}`,children:x?"Exporting...":"Export Attendance"})]}),r.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Export a spreadsheet of cadets who were absent last week. Shows which specific days they were absent and their total semester absences. Includes Tuesday of the current week."}),r.jsx("button",{onClick:a,disabled:i,className:`w-full py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:i?"Exporting...":"Export Last Week Absences"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Clear Attendance Data"}),r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Clear all attendance data. This will reset all attendance records to blank (—) for all cadets and all weeks."}),r.jsx("button",{onClick:g,disabled:F,className:`w-full py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${F?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 active:bg-red-800"}`,children:F?"Clearing...":"Clear Attendance Data"})]})})]})]})]})]})}export{xe as default};
