import{r as E,j as e}from"./react-vendor-C8iBsMnn.js";import{g as S,h as P,i as M}from"./dates-Da0E0fI-.js";import{b as k}from"./trainingEventService-Cj0evaLQ.js";import"./vendor-C6jWcdt9.js";import"./firebase-vendor-u2jlvS72.js";import"./index-BPjhbv6F.js";const $="https://api.open-meteo.com/v1/forecast",I=33.9519,W=-83.3576;async function A(g){const m=new Map,d=new Map;if(g.length===0)return{forecasts:m,errors:d};try{const h=[...g].sort(),b=h[0],u=h[h.length-1],n=new URL($);n.searchParams.set("latitude",I.toString()),n.searchParams.set("longitude",W.toString()),n.searchParams.set("start_date",b),n.searchParams.set("end_date",u),n.searchParams.set("timezone","America/New_York"),n.searchParams.set("temperature_unit","fahrenheit"),n.searchParams.set("windspeed_unit","mph"),n.searchParams.set("precipitation_unit","inch"),n.searchParams.set("daily","temperature_2m_max,temperature_2m_min,windspeed_10m_max,precipitation_probability_max"),n.searchParams.set("hourly","precipitation_probability"),console.log("Fetching weather from Open-Meteo:",n.toString());const p=await fetch(n.toString());if(!p.ok){let t="",r="";try{const c=await p.json();t=JSON.stringify(c),r=`Weather API error: ${p.status} ${p.statusText}`,c.reason&&(r+=` - ${c.reason}`)}catch{t=await p.text(),r=`Weather API error: ${p.status} ${p.statusText}`}const o={message:r,details:t,statusCode:p.status};return g.forEach(c=>{d.set(c,o)}),{forecasts:m,errors:d}}const s=await p.json();if(!s.daily||!s.daily.time||!Array.isArray(s.daily.time)){const t={message:"No daily forecast data in API response",details:`Response structure: ${JSON.stringify(Object.keys(s))}`};return g.forEach(r=>{d.set(r,t)}),{forecasts:m,errors:d}}for(const t of g){const r=s.daily.time.findIndex(o=>o===t);if(r>=0){const o=s.daily.temperature_2m_max[r],c=s.daily.temperature_2m_min[r],y=s.daily.windspeed_10m_max[r],x=s.daily.precipitation_probability_max[r]||0;let f=0,N=0;if(s.hourly&&s.hourly.time&&s.hourly.precipitation_probability){const v=new Date(t+"T00:00:00"),w=new Date(v);w.setDate(w.getDate()+1);const i=[],a=[];for(let l=0;l<s.hourly.time.length;l++){const j=new Date(s.hourly.time[l]);if(j>=v&&j<w){const D=j.getHours(),_=s.hourly.precipitation_probability[l]||0;D>=6&&D<18?i.push(_):a.push(_)}}f=i.length>0?Math.max(...i):x,N=a.length>0?Math.max(...a):x}else f=x,N=x;m.set(t,{date:t,high:Math.round(o),low:Math.round(c),wind:Math.round(y),precipDay:Math.round(f),precipNight:Math.round(N)})}else{const o={message:`No forecast data available for ${t}`,details:"Date is outside the forecast range (up to 16 days)"};d.set(t,o)}}}catch(h){const b={message:h instanceof Error?h.message:"Unknown error",details:h instanceof Error?h.stack:String(h)};g.forEach(u=>{d.set(u,b)})}return{forecasts:m,errors:d}}function R({onBack:g}){const[m,d]=E.useState([]),[h,b]=E.useState(!0),[u,n]=E.useState(null);E.useEffect(()=>{p()},[]);async function p(){b(!0);try{const t=S(),r=P(t),o=[r.monday,r.tuesday,r.wednesday,r.thursday,r.friday,r.saturday,r.sunday],{forecasts:c,errors:y}=await A(o);if(y.size>0){const i=[];y.forEach((a,l)=>{i.push(`${l}: ${a.message}${a.details?` - ${a.details}`:""}${a.statusCode?` (Status: ${a.statusCode})`:""}`)}),n(i.join(`
`))}else n(null);const x=await k(),f=new Map;x.forEach(i=>{f.set(i.date,i.name)});const N=localStorage.getItem("weatherEventsImpact"),v=N?JSON.parse(N):{},w=o.map(i=>{const a=c.get(i),l=v[i],j=f.get(i),D=(l==null?void 0:l.events)!==void 0?l.events:j||"";return{date:i,dayLabel:M(i),high:a?String(a.high):"",low:a?String(a.low):"",wind:a?String(a.wind):"",precipDay:a?String(a.precipDay):"",precipNight:a?String(a.precipNight):"",events:D,impact:(l==null?void 0:l.impact)||""}});d(w)}catch(t){const r=t instanceof Error?t.message:"Unknown error occurred",o=t instanceof Error?t.stack:String(t);n(`Error loading weather data: ${r}
${o}`),console.error("Error loading weather data:",t)}finally{b(!1)}}function s(t,r,o){const c=[...m];c[t]={...c[t],[r]:o},d(c);const y={};c.forEach(x=>{y[x.date]={events:x.events,impact:x.impact}}),localStorage.setItem("weatherEventsImpact",JSON.stringify(y))}return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe-area-inset-bottom",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 safe-area-inset-top",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Weather Data"}),e.jsx("button",{onClick:g,className:"text-sm text-blue-600 font-medium touch-manipulation",style:{minHeight:"44px",minWidth:"44px"},children:"Back"})]})}),e.jsx("main",{className:"px-4 py-4",children:h?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading weather data..."}):u?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-900 mb-2",children:"Weather Data Error"}),e.jsx("pre",{className:"text-sm text-red-800 whitespace-pre-wrap break-words",children:u})]}):m.length===0||m.every(t=>!t.high&&!t.low)?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No weather data available"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-300 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white border-b border-gray-300",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Day"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"High (°F)"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Low (°F)"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Wind (mph)"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Precip. Day"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Precip. Night"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900 border-r border-gray-300",children:"Events"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-900",children:"Impact"})]})}),e.jsx("tbody",{children:m.map((t,r)=>e.jsxs("tr",{className:"border-b border-gray-300 last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 text-sm text-gray-900 border-r border-gray-300 whitespace-nowrap bg-white",children:t.dayLabel}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("div",{className:"px-2 py-1 text-sm text-gray-900",children:t.high||"--"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("div",{className:"px-2 py-1 text-sm text-gray-900",children:t.low||"--"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("div",{className:"px-2 py-1 text-sm text-gray-900",children:t.wind||"--"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("div",{className:"px-2 py-1 text-sm text-gray-900",children:t.precipDay||"--"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("div",{className:"px-2 py-1 text-sm text-gray-900",children:t.precipNight||"--"})}),e.jsx("td",{className:"px-3 py-2 border-r border-gray-300 bg-white",children:e.jsx("input",{type:"text",value:t.events,onChange:o=>s(r,"events",o.target.value),className:"w-full px-2 py-1 text-sm border-0 bg-transparent focus:outline-none focus:bg-blue-50",placeholder:"NONE"})}),e.jsx("td",{className:"px-3 py-2 bg-white",children:e.jsx("input",{type:"text",value:t.impact,onChange:o=>s(r,"impact",o.target.value),className:"w-full px-2 py-1 text-sm border-0 bg-transparent focus:outline-none focus:bg-blue-50",placeholder:"NONE"})})]},t.date))})]})})})})]})}export{R as default};
