import{r as k,j as e}from"./react-vendor-C8iBsMnn.js";import{s as ve,g as z}from"./cadetService-BXy_--2f.js";import{s as Ne,g as ee,a as se,b as we,u as Te,c as Ce}from"./attendanceService-BpGXN45O.js";import{g as _,a as ke,b as Me,f as J,c as Pe,d as te}from"./dates-Da0E0fI-.js";import"./vendor-C6jWcdt9.js";import"./firebase-vendor-u2jlvS72.js";import"./index-DKB6D4ej.js";function G(t,l,r="PT"){const n={present:0,excused:0,unexcused:0};return t.forEach(i=>{let d=null;r==="PT"?l==="monday"?d=i.ptMonday??null:l==="tuesday"?d=i.ptTuesday:l==="wednesday"?d=i.ptWednesday:l==="thursday"?d=i.ptThursday:l==="friday"&&(d=i.ptFriday??null):r==="Lab"&&l==="thursday"&&(d=i.labThursday),d==="present"?n.present++:d==="excused"?n.excused++:d==="unexcused"&&n.unexcused++}),n}function Ee(t,l="PT"){const r={present:0,excused:0,unexcused:0};return t.forEach(n=>{if(l==="PT")[n.ptMonday,n.ptTuesday,n.ptWednesday,n.ptThursday,n.ptFriday].filter(d=>d!==void 0).forEach(d=>{d==="present"?r.present++:d==="excused"?r.excused++:d==="unexcused"&&r.unexcused++});else if(l==="Lab"){const i=n.labThursday;i==="present"?r.present++:i==="excused"?r.excused++:i==="unexcused"&&r.unexcused++}}),r}function ne(t,l,r,n,i="PT"){const d=new Map;return t.forEach(c=>{const o=l.get(c.cadetId);if(!o)return;let x=!1;if(i==="PT"?r==="week"?x=c.ptMonday===n||c.ptTuesday===n||c.ptWednesday===n||c.ptThursday===n||c.ptFriday===n:r==="monday"?x=c.ptMonday===n:r==="tuesday"?x=c.ptTuesday===n:r==="wednesday"?x=c.ptWednesday===n:r==="thursday"?x=c.ptThursday===n:r==="friday"&&(x=c.ptFriday===n):i==="Lab"&&(r==="week"||r==="thursday")&&(x=c.labThursday===n),x){const b=o.militaryScienceLevel;d.has(b)||d.set(b,[]),d.get(b).push({id:c.cadetId,name:`${o.lastName}, ${o.firstName}`,level:o.militaryScienceLevel})}}),d.forEach((c,o)=>{c.sort((x,b)=>x.name.localeCompare(b.name))}),d}function Xe({company:t,onBack:l,onSelectCadet:r}){const[n,i]=k.useState([]),[d,c]=k.useState(new Map),[o,x]=k.useState(new Map),[b,T]=k.useState(!0),[L,M]=k.useState(!1),[W,w]=k.useState("week"),[g,V]=k.useState(_()),[h,E]=k.useState("PT"),[B,y]=k.useState(new Map),[f,p]=k.useState(new Map),[N,P]=k.useState(null),C=ke(g),A=t==="Ranger"&&h==="PT";k.useEffect(()=>{T(!0);const s=ve(t,u=>{i(u),T(!1)},u=>{console.error("Error in cadets subscription:",u),z(t).then(i).catch(a=>{console.error("Error loading cadets:",a),alert(`Error loading data: ${a instanceof Error?a.message:"Unknown error"}`)}).finally(()=>T(!1))}),m=Ne(t,g,u=>{c(u),x(a=>JSON.stringify(Array.from(u.entries()).sort())!==JSON.stringify(Array.from(a.entries()).sort())?a:new Map(u)),T(!1)},u=>{console.error("Error in attendance subscription:",u),ee(t,g).then(a=>{c(a),x(new Map(a))}).catch(a=>{console.error("Error loading attendance:",a)}).finally(()=>T(!1))});return Promise.all([z(t),ee(t,g)]).then(([u,a])=>{i(u),c(a),x(new Map(a)),T(!1)}).catch(u=>{console.error("Error loading data:",u),alert(`Error loading data: ${u instanceof Error?u.message:"Unknown error"}

Please check:
1. Firestore is enabled in Firebase Console
2. Internet connection is working
3. Browser console for more details`),T(!1)}),()=>{s(),m()}},[t,g]),k.useEffect(()=>{n.length>0&&H()},[n]);async function H(){try{const s=n.map(a=>a.id),[m,u]=await Promise.all([se(s,"PT"),se(s,"Lab")]);y(m),p(u)}catch(s){console.error("Error loading unexcused totals:",s)}}function X(s,m,u,a){x(j=>{const v=new Map(j),$={...v.get(s)||{cadetId:s,ptMonday:null,ptTuesday:null,ptWednesday:null,ptThursday:null,ptFriday:null,labThursday:null,weekStartDate:g},weekStartDate:g};return a==="PT"?m==="monday"?$.ptMonday=u||null:m==="tuesday"?$.ptTuesday=u||null:m==="wednesday"?$.ptWednesday=u||null:m==="thursday"?$.ptThursday=u||null:m==="friday"&&($.ptFriday=u||null):a==="Lab"&&m==="thursday"&&($.labThursday=u||null),v.set(s,$),v})}function U(s,m,u){x(a=>{const j=new Map(a);return n.forEach(v=>{const $={...j.get(v.id)||{cadetId:v.id,ptMonday:null,ptTuesday:null,ptWednesday:null,ptThursday:null,ptFriday:null,labThursday:null,weekStartDate:g},weekStartDate:g};m==="PT"?s==="monday"?$.ptMonday=u:s==="tuesday"?$.ptTuesday=u:s==="wednesday"?$.ptWednesday=u:s==="thursday"?$.ptThursday=u:s==="friday"&&($.ptFriday=u):m==="Lab"&&s==="thursday"&&($.labThursday=u),j.set(v.id,$)}),j})}async function K(s,m){U(s,m,"present")}async function S(s,m){U(s,m,"excused")}async function le(s,m){U(s,m,"unexcused")}async function de(s,m){U(s,m,null)}async function ie(){M(!0);try{const s=[];o.forEach((a,j)=>{const v=d.get(j);a.ptMonday!==((v==null?void 0:v.ptMonday)??null)&&s.push({cadetId:j,day:"monday",status:a.ptMonday??null,type:"PT"}),a.ptTuesday!==((v==null?void 0:v.ptTuesday)??null)&&s.push({cadetId:j,day:"tuesday",status:a.ptTuesday,type:"PT"}),a.ptWednesday!==((v==null?void 0:v.ptWednesday)??null)&&s.push({cadetId:j,day:"wednesday",status:a.ptWednesday,type:"PT"}),a.ptThursday!==((v==null?void 0:v.ptThursday)??null)&&s.push({cadetId:j,day:"thursday",status:a.ptThursday,type:"PT"}),a.ptFriday!==((v==null?void 0:v.ptFriday)??null)&&s.push({cadetId:j,day:"friday",status:a.ptFriday??null,type:"PT"}),a.labThursday!==((v==null?void 0:v.labThursday)??null)&&s.push({cadetId:j,day:"thursday",status:a.labThursday,type:"Lab"})}),d.forEach((a,j)=>{o.has(j)||(a.ptMonday!==null&&a.ptMonday!==void 0&&s.push({cadetId:j,day:"monday",status:null,type:"PT"}),a.ptTuesday!==null&&s.push({cadetId:j,day:"tuesday",status:null,type:"PT"}),a.ptWednesday!==null&&s.push({cadetId:j,day:"wednesday",status:null,type:"PT"}),a.ptThursday!==null&&s.push({cadetId:j,day:"thursday",status:null,type:"PT"}),a.ptFriday!==null&&a.ptFriday!==void 0&&s.push({cadetId:j,day:"friday",status:null,type:"PT"}),a.labThursday!==null&&s.push({cadetId:j,day:"thursday",status:null,type:"Lab"}))});const m=new Map;s.forEach(({cadetId:a})=>{if(!m.has(a)){const j=o.get(a);j?m.set(a,{...j}):m.set(a,{cadetId:a,weekStartDate:g,ptMonday:null,ptTuesday:null,ptWednesday:null,ptThursday:null,ptFriday:null,labThursday:null})}});const u=Array.from(m.values());u.length>1?await we(u):u.length===1&&await Te(u[0]),c(new Map(o)),await H(),t==="Master"&&await loadData(),alert(t==="Master"?"Attendance saved successfully! Changes will be reflected in all company rosters.":"Attendance saved successfully!")}catch(s){console.error("Error saving attendance:",s),alert(`Error saving attendance: ${s instanceof Error?s.message:"Unknown error"}`),await loadData()}finally{M(!1)}}const D=Array.from(o.values()),R=new Map(n.map(s=>[s.id,s])),ue=A?G(D,"monday",h):{present:0,excused:0,unexcused:0},oe=h==="PT"?G(D,"tuesday",h):{present:0,excused:0,unexcused:0},ce=h==="PT"?G(D,"wednesday",h):{present:0,excused:0,unexcused:0},xe=G(D,"thursday",h),me=A?G(D,"friday",h):{present:0,excused:0,unexcused:0},he=Ee(D,h),ye=ne(D,R,W,"excused",h),pe=ne(D,R,W,"unexcused",h),fe=h==="PT"?B:f,Q=Me(),ge=_(),be=g===ge;let O=null,Y="";be&&(Q===C.monday?(O="monday",Y=C.monday):Q===C.tuesday?(O="tuesday",Y=C.tuesday):Q===C.wednesday?(O="wednesday",Y=C.wednesday):Q===C.thursday?(O="thursday",Y=C.thursday):Q===C.friday&&(O="friday",Y=C.friday));let q={present:0,excused:0,unexcused:0,assigned:n.length};O&&(q=G(D,O,h),q.assigned=n.length);const I=JSON.stringify(Array.from(d.entries()).sort())!==JSON.stringify(Array.from(o.entries()).sort());return b?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe-area-inset-bottom",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 safe-area-inset-top",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:t==="Master"?"Master List":`${t} Company`}),e.jsx("button",{onClick:l,className:"text-sm text-blue-600 font-medium touch-manipulation",style:{minHeight:"44px",minWidth:"44px"},children:"Home"})]})}),e.jsxs("main",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex border-b border-gray-200 mb-4 bg-white rounded-t-lg",children:[e.jsx("button",{onClick:()=>E("PT"),className:`flex-1 py-3 text-sm font-medium touch-manipulation ${h==="PT"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600"}`,children:"PT"}),e.jsx("button",{onClick:()=>E("Lab"),className:`flex-1 py-3 text-sm font-medium touch-manipulation ${h==="Lab"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600"}`,children:"Lab"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 overflow-x-auto",children:e.jsxs("div",{className:`grid gap-2 text-center min-w-full ${A?"grid-cols-6":h==="PT"?"grid-cols-4":"grid-cols-2"}`,children:[e.jsx("div",{className:"font-semibold text-gray-700",children:"Name"}),A&&e.jsx(Z,{date:C.monday,day:"monday",attendanceType:h,company:t,onContextMenu:(s,m)=>{s.preventDefault(),P({day:m,type:h,x:s.clientX,y:s.clientY})}}),h==="PT"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{date:C.tuesday,day:"tuesday",attendanceType:h,company:t,onContextMenu:(s,m)=>{s.preventDefault(),P({day:m,type:h,x:s.clientX,y:s.clientY})}}),e.jsx(Z,{date:C.wednesday,day:"wednesday",attendanceType:h,company:t,onContextMenu:(s,m)=>{s.preventDefault(),P({day:m,type:h,x:s.clientX,y:s.clientY})}})]}),e.jsx(Z,{date:C.thursday,day:"thursday",attendanceType:h,company:t,onContextMenu:(s,m)=>{s.preventDefault(),P({day:m,type:h,x:s.clientX,y:s.clientY})}}),A&&e.jsx(Z,{date:C.friday,day:"friday",attendanceType:h,company:t,onContextMenu:(s,m)=>{s.preventDefault(),P({day:m,type:h,x:s.clientX,y:s.clientY})}})]})}),N&&e.jsx(Le,{x:N.x,y:N.y,onClose:()=>P(null),onMarkAllPresent:()=>{K(N.day,N.type),P(null)},onMarkAllExcused:()=>{S(N.day,N.type),P(null)},onMarkAllUnexcused:()=>{le(N.day,N.type),P(null)},onClearAll:()=>{de(N.day,N.type),P(null)}}),e.jsx("div",{className:"space-y-2",children:t==="Master"?(()=>{const s=new Map;return n.forEach(u=>{const a=u.militaryScienceLevel;s.has(a)||s.set(a,[]),s.get(a).push(u)}),Array.from(s.keys()).sort((u,a)=>{const j=parseInt(u.replace("MS","")),v=parseInt(a.replace("MS",""));return j-v}).map(u=>e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-100 border-b-2 border-gray-300 px-4 py-2 mb-2 rounded-t-lg",children:e.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:u})}),e.jsx("div",{className:"space-y-2 mb-4",children:s.get(u).map(a=>{const j=o.get(a.id);return e.jsx(ae,{cadet:a,attendance:j,onStatusChange:X,onSelectCadet:r,attendanceType:h,company:t,showMondayFriday:A},a.id)})})]},u))})():n.map(s=>{const m=o.get(s.id);return e.jsx(ae,{cadet:s,attendance:m,onStatusChange:X,onSelectCadet:r,attendanceType:h,company:t,showMondayFriday:A},s.id)})}),n.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No cadets found for ",t," Company"]}),n.length>0&&e.jsx("div",{className:"mt-4 mb-4",children:e.jsx("button",{onClick:ie,disabled:!I||L,className:`w-full py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${I&&!L?"bg-blue-600 hover:bg-blue-700 active:bg-blue-800":"bg-gray-400 cursor-not-allowed"}`,children:L?"Saving...":I?"Save Changes":"All Changes Saved"})}),n.length>0&&O&&Y&&e.jsxs("div",{className:"mb-4 bg-blue-50 rounded-lg border border-blue-200 p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-900 mb-2",children:["Today's Attendance (",J(Y),")"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:q.assigned}),e.jsx("div",{className:"text-xs text-gray-600",children:"Assigned"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-present",children:q.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-excused",children:q.excused}),e.jsx("div",{className:"text-xs text-gray-600",children:"Excused"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-unexcused",children:q.unexcused}),e.jsx("div",{className:"text-xs text-gray-600",children:"Unexcused"})]})]})]}),n.length>0&&e.jsx($e,{currentWeekStart:g,onWeekChange:V}),n.length>0&&e.jsx(We,{company:t,cadets:n,records:D,mondayStats:ue,tuesdayStats:oe,wednesdayStats:ce,thursdayStats:xe,fridayStats:me,weekStats:he,weekDates:C,excusedByLevel:ye,unexcusedByLevel:pe,selectedDay:W,onDayChange:w,unexcusedTotals:fe,currentWeekStart:g,onWeekChange:V,attendanceType:h,showMondayFriday:A})]})]})}function ae({cadet:t,attendance:l,onStatusChange:r,onSelectCadet:n,attendanceType:i,company:d,showMondayFriday:c}){const o=(l==null?void 0:l.ptMonday)??null,x=(l==null?void 0:l.ptTuesday)??null,b=(l==null?void 0:l.ptWednesday)??null,T=(l==null?void 0:l.ptThursday)??null,L=(l==null?void 0:l.ptFriday)??null,M=(l==null?void 0:l.labThursday)??null;function W(w){return w==="present"?"border-present text-present":w==="excused"?"border-excused text-excused":w==="unexcused"?"border-unexcused text-unexcused":"border-gray-300 text-gray-600"}return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:`grid gap-2 p-3 min-w-full ${c?"grid-cols-6":i==="PT"?"grid-cols-4":"grid-cols-2"}`,children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{onClick:()=>n==null?void 0:n(t.id),className:"font-medium text-blue-600 hover:text-blue-800 text-sm text-left touch-manipulation",children:[t.lastName,", ",t.firstName]})}),c&&e.jsxs("select",{value:o||"",onChange:w=>{const g=w.target.value;r(t.id,"monday",g===""?null:g,"PT")},"aria-label":`${t.firstName} ${t.lastName} Monday PT attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${W(o)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]}),i==="PT"&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:x||"",onChange:w=>{const g=w.target.value;r(t.id,"tuesday",g===""?null:g,"PT")},"aria-label":`${t.firstName} ${t.lastName} Tuesday PT attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${W(x)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]}),e.jsxs("select",{value:b||"",onChange:w=>{const g=w.target.value;r(t.id,"wednesday",g===""?null:g,"PT")},"aria-label":`${t.firstName} ${t.lastName} Wednesday PT attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${W(b)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]})]}),e.jsxs("select",{value:(i==="PT"?T:M)||"",onChange:w=>{const g=w.target.value;r(t.id,"thursday",g===""?null:g,i)},"aria-label":`${t.firstName} ${t.lastName} Thursday ${i} attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${W(i==="PT"?T:M)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]}),c&&e.jsxs("select",{value:L||"",onChange:w=>{const g=w.target.value;r(t.id,"friday",g===""?null:g,"PT")},"aria-label":`${t.firstName} ${t.lastName} Friday PT attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${W(L)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]})]})})}function We({company:t,cadets:l,records:r,mondayStats:n,tuesdayStats:i,wednesdayStats:d,thursdayStats:c,fridayStats:o,weekStats:x,weekDates:b,excusedByLevel:T,unexcusedByLevel:L,selectedDay:M,onDayChange:W,unexcusedTotals:w,currentWeekStart:g,onWeekChange:V,attendanceType:h,showMondayFriday:E}){const[B,y]=k.useState(!1),[f,p]=k.useState("summary");return _(),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("button",{onClick:()=>y(!B),className:"w-full flex items-center justify-between bg-white rounded-lg border border-gray-200 p-4 hover:bg-gray-50 touch-manipulation",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:[h," Attendance Statistics"]}),e.jsx("svg",{className:`w-5 h-5 text-gray-600 transition-transform duration-200 ${B?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),B&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>p("summary"),className:`flex-1 py-3 text-sm font-medium touch-manipulation ${f==="summary"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600"}`,children:"Summary"}),e.jsx("button",{onClick:()=>p("excused"),className:`flex-1 py-3 text-sm font-medium touch-manipulation ${f==="excused"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600"}`,children:"Excused"}),e.jsx("button",{onClick:()=>p("unexcused"),className:`flex-1 py-3 text-sm font-medium touch-manipulation ${f==="unexcused"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600"}`,children:"Unexcused"})]}),e.jsxs("div",{className:"p-4",children:[f==="summary"&&e.jsx(Se,{company:t,cadets:l,records:r,mondayStats:n,tuesdayStats:i,wednesdayStats:d,thursdayStats:c,fridayStats:o,weekStats:x,weekDates:b,unexcusedTotals:w,currentWeekStart:g,attendanceType:h,showMondayFriday:E,onRecordsUpdate:async()=>{}}),f==="excused"&&e.jsx(re,{cadetsByLevel:T,status:"Excused",selectedDay:M,onDayChange:W,attendanceType:h,showMondayFriday:E}),f==="unexcused"&&e.jsx(re,{cadetsByLevel:L,status:"Unexcused",selectedDay:M,onDayChange:W,attendanceType:h,showMondayFriday:E})]})]})]})}function $e({currentWeekStart:t,onWeekChange:l}){const r=_();function n(){const o=te(t,-1);l(o)}function i(){const o=te(t,1);l(o)}function d(){l(r)}const c=t===r;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,className:"flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 hover:bg-gray-50 active:bg-gray-100 touch-manipulation transition-colors","aria-label":"Previous week",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 text-center px-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Week of ",Pe(t)]}),!c&&e.jsx("button",{onClick:d,className:"text-xs text-blue-600 hover:text-blue-700 mt-1 touch-manipulation",children:"Return to Current Week"})]}),e.jsx("button",{onClick:i,className:"flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 hover:bg-gray-50 active:bg-gray-100 touch-manipulation transition-colors","aria-label":"Next week",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})}function Se({company:t,cadets:l,records:r,mondayStats:n,tuesdayStats:i,wednesdayStats:d,thursdayStats:c,fridayStats:o,weekStats:x,weekDates:b,unexcusedTotals:T,currentWeekStart:L,attendanceType:M,showMondayFriday:W}){const[w,g]=k.useState(new Map),V=new Map(l.map(y=>[y.id,y]));k.useEffect(()=>{t==="Master"&&h()},[t,L,r,M]);async function h(){try{const y=await Ce(L),f=await Promise.all([z("Alpha"),z("Bravo"),z("Charlie"),z("Ranger"),z("Headquarters Company")]),p=new Map;["Alpha","Bravo","Charlie","Ranger","Headquarters Company"].forEach((N,P)=>{const C=f[P],A=new Set(C.map(K=>K.id)),H={present:0,excused:0,unexcused:0},X={present:0,excused:0,unexcused:0},U={present:0,excused:0,unexcused:0};for(const[K,S]of y.entries())A.has(K)&&(M==="PT"?(S.ptTuesday==="present"?H.present++:S.ptTuesday==="excused"?H.excused++:S.ptTuesday==="unexcused"&&H.unexcused++,S.ptWednesday==="present"?X.present++:S.ptWednesday==="excused"?X.excused++:S.ptWednesday==="unexcused"&&X.unexcused++,S.ptThursday==="present"?U.present++:S.ptThursday==="excused"?U.excused++:S.ptThursday==="unexcused"&&U.unexcused++):M==="Lab"&&(S.labThursday==="present"?U.present++:S.labThursday==="excused"?U.excused++:S.labThursday==="unexcused"&&U.unexcused++));p.set(N,{tuesday:H,wednesday:X,thursday:U})}),g(p)}catch(y){console.error("Error loading company stats:",y)}}const E=(y,f)=>r.filter(p=>{if(M==="PT"){if(y==="monday")return p.ptMonday===f;if(y==="tuesday")return p.ptTuesday===f;if(y==="wednesday")return p.ptWednesday===f;if(y==="thursday")return p.ptThursday===f;if(y==="friday")return p.ptFriday===f}else if(M==="Lab"&&y==="thursday")return p.labThursday===f;return!1}).map(p=>{const N=V.get(p.cadetId);if(!N)return null;const P=`${N.lastName}, ${N.firstName}`;if(f==="unexcused"){const C=T.get(p.cadetId)||0;return{name:P,count:C}}return{name:P}}).filter(p=>p!==null).sort((p,N)=>p.name.localeCompare(N.name)),B=y=>{const f=new Map;return r.forEach(p=>{let N=!1;if(M==="PT"?N=p.ptMonday===y||p.ptTuesday===y||p.ptWednesday===y||p.ptThursday===y||p.ptFriday===y:M==="Lab"&&(N=p.labThursday===y),N){const P=V.get(p.cadetId);if(P){const C=`${P.lastName}, ${P.firstName}`;if(y==="unexcused"){const A=T.get(p.cadetId)||0;f.set(C,A)}else f.set(C,0)}}}),Array.from(f.entries()).map(([p,N])=>({name:p,count:y==="unexcused"?N:void 0})).sort((p,N)=>p.name.localeCompare(N.name))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Daily Statistics"}),W&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Monday"}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:J(b.monday)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-present",children:n.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsx(F,{count:n.excused,label:"Excused",cadetNames:E("monday","excused"),colorClass:"text-excused"}),e.jsx(F,{count:n.unexcused,label:"Unexcused",cadetNames:E("monday","unexcused"),colorClass:"text-unexcused"})]})]}),M==="PT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Tuesday"}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:J(b.tuesday)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-present",children:i.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsx(F,{count:i.excused,label:"Excused",cadetNames:E("tuesday","excused"),colorClass:"text-excused"}),e.jsx(F,{count:i.unexcused,label:"Unexcused",cadetNames:E("tuesday","unexcused"),colorClass:"text-unexcused"})]}),t==="Master"&&w.size>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"By Company:"}),e.jsx("div",{className:"space-y-2",children:Array.from(w.entries()).map(([y,f])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[y,":"]}),e.jsxs("span",{className:"text-gray-900",children:["P:",f.tuesday.present," E:",f.tuesday.excused," U:",f.tuesday.unexcused]})]},y))})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Wednesday"}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:J(b.wednesday)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-present",children:d.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsx(F,{count:d.excused,label:"Excused",cadetNames:E("wednesday","excused"),colorClass:"text-excused"}),e.jsx(F,{count:d.unexcused,label:"Unexcused",cadetNames:E("wednesday","unexcused"),colorClass:"text-unexcused"})]}),t==="Master"&&w.size>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"By Company:"}),e.jsx("div",{className:"space-y-2",children:Array.from(w.entries()).map(([y,f])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[y,":"]}),e.jsxs("span",{className:"text-gray-900",children:["P:",f.wednesday.present," E:",f.wednesday.excused," U:",f.wednesday.unexcused]})]},y))})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Thursday"}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:J(b.thursday)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-present",children:c.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsx(F,{count:c.excused,label:"Excused",cadetNames:E("thursday","excused"),colorClass:"text-excused"}),e.jsx(F,{count:c.unexcused,label:"Unexcused",cadetNames:E("thursday","unexcused"),colorClass:"text-unexcused"})]}),t==="Master"&&w.size>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"By Company:"}),e.jsx("div",{className:"space-y-2",children:Array.from(w.entries()).map(([y,f])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[y,":"]}),e.jsxs("span",{className:"text-gray-900",children:["P:",f.thursday.present," E:",f.thursday.excused," U:",f.thursday.unexcused]})]},y))})]})]}),W&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Friday"}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:J(b.friday)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-present",children:o.present}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsx(F,{count:o.excused,label:"Excused",cadetNames:E("friday","excused"),colorClass:"text-excused"}),e.jsx(F,{count:o.unexcused,label:"Unexcused",cadetNames:E("friday","unexcused"),colorClass:"text-unexcused"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Weekly Totals"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-present",children:x.present}),e.jsx("div",{className:"text-sm text-gray-600",children:"Present"})]}),e.jsx(F,{count:x.excused,label:"Excused",cadetNames:B("excused"),colorClass:"text-excused",size:"large"}),e.jsx(F,{count:x.unexcused,label:"Unexcused",cadetNames:B("unexcused"),colorClass:"text-unexcused",size:"large"})]})})]})]})}function F({count:t,label:l,cadetNames:r,colorClass:n,size:i="normal"}){const[d,c]=k.useState(!1),o=k.useRef(null);return k.useEffect(()=>{function x(b){o.current&&!o.current.contains(b.target)&&c(!1)}if(d){const b=setTimeout(()=>{document.addEventListener("mousedown",x),document.addEventListener("touchstart",x)},100);return()=>{clearTimeout(b),document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}}},[d]),t===0?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:i==="large"?"text-2xl font-bold text-gray-400":`text-lg font-bold ${n}`,children:t}),e.jsx("div",{className:i==="large"?"text-sm text-gray-600":"text-xs text-gray-600",children:l})]}):e.jsxs("div",{className:"text-center relative",ref:o,children:[e.jsx("div",{className:`${i==="large"?"text-2xl":"text-lg"} font-bold ${n} cursor-pointer touch-manipulation`,onClick:()=>c(!d),children:t}),e.jsx("div",{className:i==="large"?"text-sm text-gray-600":"text-xs text-gray-600",children:l}),d&&r.length>0&&e.jsxs("div",{className:"absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-white text-gray-900 text-xs rounded-lg shadow-lg border border-gray-300 p-3 max-h-64 overflow-y-auto",children:[e.jsxs("div",{className:"font-semibold mb-2 text-gray-900",children:[l," Cadets:"]}),e.jsx("div",{className:"space-y-1",children:r.map((x,b)=>e.jsxs("div",{className:"text-gray-700",children:[x.name,x.count!==void 0?` (${x.count})`:""]},b))}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}function re({cadetsByLevel:t,status:l,selectedDay:r,onDayChange:n,attendanceType:i,showMondayFriday:d=!1}){const c=Array.from(t.keys()).sort(),o=Array.from(t.values()).reduce((x,b)=>x+b.length,0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"View by Day/Week"}),e.jsxs("div",{className:`grid gap-2 ${d?"grid-cols-6":i==="PT"?"grid-cols-4":"grid-cols-2"}`,children:[e.jsx("button",{onClick:()=>n("week"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="week"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Week"}),d&&e.jsx("button",{onClick:()=>n("monday"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="monday"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Mon"}),i==="PT"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n("tuesday"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="tuesday"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Tue"}),e.jsx("button",{onClick:()=>n("wednesday"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="wednesday"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Wed"})]}),e.jsx("button",{onClick:()=>n("thursday"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="thursday"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Thu"}),d&&e.jsx("button",{onClick:()=>n("friday"),className:`py-2 px-3 rounded-md text-sm font-medium touch-manipulation ${r==="friday"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-300"}`,children:"Fri"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:o}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total ",l]})]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No ",l.toLowerCase()," cadets found"]}):c.map(x=>{const b=t.get(x);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"font-semibold text-gray-900 mb-2",children:[x," (",b.length,")"]}),e.jsx("div",{className:"space-y-1",children:b.map(T=>e.jsx("div",{className:"text-sm text-gray-700 py-1",children:T.name},T.id))})]},x)})]})}function Z({date:t,day:l,attendanceType:r,company:n,onContextMenu:i}){const d=n!=="Master",c=o=>{d&&(o.preventDefault(),i(o,l))};return e.jsx("div",{className:`font-semibold text-gray-700 text-sm ${d?"cursor-pointer hover:bg-gray-50 rounded px-2 py-1 touch-manipulation":""}`,onContextMenu:d?o=>{o.preventDefault(),i(o,l)}:void 0,onClick:d?c:void 0,children:J(t)})}function Le({x:t,y:l,onClose:r,onMarkAllPresent:n,onMarkAllExcused:i,onMarkAllUnexcused:d,onClearAll:c}){const o=k.useRef(null);k.useEffect(()=>{function T(M){o.current&&!o.current.contains(M.target)&&r()}const L=setTimeout(()=>{document.addEventListener("mousedown",T),document.addEventListener("touchstart",T)},100);return()=>{clearTimeout(L),document.removeEventListener("mousedown",T),document.removeEventListener("touchstart",T)}},[r]);const x=Math.min(t,window.innerWidth-200),b=Math.min(l,window.innerHeight-200);return e.jsxs("div",{ref:o,className:"fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 py-2 min-w-[180px]",style:{left:`${x}px`,top:`${b}px`},children:[e.jsx("button",{onClick:()=>{n(),r()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 touch-manipulation",children:"Mark All Present"}),e.jsx("button",{onClick:()=>{i(),r()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 touch-manipulation",children:"Mark All Excused"}),e.jsx("button",{onClick:()=>{d(),r()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 touch-manipulation",children:"Mark All Unexcused"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>{c(),r()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 touch-manipulation",children:"Clear All"})]})}export{Xe as default};
