import{r as n,j as e}from"./react-vendor-C8iBsMnn.js";import{a as F,u as V,d as H}from"./cadetService-bh6XJydc.js";import{d as L,e as E}from"./attendanceService-MnY5YM3z.js";import{f as k}from"./dates-Da0E0fI-.js";import"./vendor-C6jWcdt9.js";import"./firebase-vendor-u2jlvS72.js";import"./index-D3ls51t0.js";const q=["MS1","MS2","MS3","MS4","MS5"],J=["Alpha","Bravo","Charlie","Ranger","Headquarters Company"],g="https://t3.ftcdn.net/jpg/00/57/04/58/360_F_57045887_HHJml6DJVxNBMqMeDqVJ0ZQDnotp5rGD.jpg";function ee({cadetId:o,onBack:U,onDelete:R,onCompanyChange:T}){const[a,M]=n.useState(null),[h,A]=n.useState(0),[b,X]=n.useState(0),[f,B]=n.useState(0),[z,P]=n.useState(!0),[p,D]=n.useState(!1),[l,y]=n.useState(!1),[s,i]=n.useState({}),[c,d]=n.useState(null),[u,m]=n.useState([]),v=n.useRef(null),N=n.useRef(null),j=n.useRef(null);n.useEffect(()=>{w()},[o]),n.useEffect(()=>{function t(r){c&&v.current&&!v.current.contains(r.target)&&N.current&&!N.current.contains(r.target)&&j.current&&!j.current.contains(r.target)&&!r.target.closest(".absolute.z-50")&&(d(null),m([]))}if(c)return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[c]);async function w(){P(!0);try{const t=await F(o);if(t){M(t),i({firstName:t.firstName||"",lastName:t.lastName||"",age:t.age||0,dateOfBirth:t.dateOfBirth||"",shirtSize:t.shirtSize||"",position:t.position||"",company:t.company,militaryScienceLevel:t.militaryScienceLevel||"MS1",phoneNumber:t.phoneNumber||"",email:t.email||"",contracted:t.contracted||"N",profilePicture:t.profilePicture||""});const[r,C,S]=await Promise.all([L(o,"PT"),L(o,"Lab"),L(o,"Tactics")]);A(r),X(C),B(S)}}catch(t){console.error("Error loading cadet:",t),alert(`Error loading cadet: ${t instanceof Error?t.message:"Unknown error"}`)}finally{P(!1)}}async function O(){if(a){D(!0);try{const t=a.company,r=s.company;await V(o,s),t&&r&&t!==r&&T&&T(t,r),await w(),y(!1),alert("Cadet profile updated successfully!")}catch(t){console.error("Error saving cadet:",t),alert(`Error saving cadet: ${t instanceof Error?t.message:"Unknown error"}`)}finally{D(!1)}}}async function _(){if(!(!a||!window.confirm(`Are you sure you want to delete ${a.firstName} ${a.lastName}? This action cannot be undone.`)))try{await H(o),alert("Cadet deleted successfully!"),R()}catch(r){console.error("Error deleting cadet:",r),alert(`Error deleting cadet: ${r instanceof Error?r.message:"Unknown error"}`)}}return z?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading..."})}):a?e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe-area-inset-bottom",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 safe-area-inset-top",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Cadet Profile"}),e.jsx("button",{onClick:U,className:"text-sm text-blue-600 font-medium touch-manipulation",style:{minHeight:"44px",minWidth:"44px"},children:"Back"})]})}),e.jsx("main",{className:"px-4 py-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[a.firstName," ",a.lastName]}),!l&&e.jsx("button",{onClick:()=>y(!0),className:"text-sm text-blue-600 font-medium touch-manipulation px-3 py-1",children:"Edit"})]}),e.jsx("div",{className:"mb-4",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Picture URL"}),e.jsx("input",{type:"url",value:s.profilePicture||"",onChange:t=>i({...s,profilePicture:t.target.value}),placeholder:"Enter image URL...",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.profilePicture||g,alt:`${a.firstName} ${a.lastName}`,className:"w-32 h-32 rounded-full object-cover border-2 border-gray-200",onError:t=>{t.target.src=g}})})]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:a.profilePicture||g,alt:`${a.firstName} ${a.lastName}`,className:"w-32 h-32 rounded-full object-cover border-2 border-gray-200",onError:t=>{t.target.src=g}})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),l?e.jsx("input",{type:"text",value:s.firstName||"",onChange:t=>i({...s,firstName:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):e.jsx("div",{className:"text-gray-900",children:a.firstName||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),l?e.jsx("input",{type:"text",value:s.lastName||"",onChange:t=>i({...s,lastName:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):e.jsx("div",{className:"text-gray-900",children:a.lastName||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Age"}),l?e.jsx("input",{type:"number",value:s.age||"",onChange:t=>i({...s,age:parseInt(t.target.value)||0}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):e.jsx("div",{className:"text-gray-900",children:a.age||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),l?e.jsx("input",{type:"date",value:s.dateOfBirth||"",onChange:t=>i({...s,dateOfBirth:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):e.jsx("div",{className:"text-gray-900",children:a.dateOfBirth?new Date(a.dateOfBirth).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shirt Size"}),l?e.jsxs("select",{value:s.shirtSize||"",onChange:t=>i({...s,shirtSize:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Select size"}),e.jsx("option",{value:"XS",children:"XS"}),e.jsx("option",{value:"S",children:"S"}),e.jsx("option",{value:"M",children:"M"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"XL",children:"XL"}),e.jsx("option",{value:"XXL",children:"XXL"}),e.jsx("option",{value:"XXXL",children:"XXXL"})]}):e.jsx("div",{className:"text-gray-900",children:a.shirtSize||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company"}),l?e.jsx("select",{value:s.company||"Alpha",onChange:t=>i({...s,company:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:J.map(t=>e.jsx("option",{value:t,children:t},t))}):e.jsx("div",{className:"text-gray-900",children:a.company||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),l?e.jsx("input",{type:"text",value:s.position||"",onChange:t=>i({...s,position:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):e.jsx("div",{className:"text-gray-900",children:a.position||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MS Level"}),l?e.jsx("select",{value:s.militaryScienceLevel||"MS1",onChange:t=>i({...s,militaryScienceLevel:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:q.map(t=>e.jsx("option",{value:t,children:t},t))}):e.jsx("div",{className:"text-gray-900",children:a.militaryScienceLevel||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),l?e.jsx("input",{type:"tel",value:s.phoneNumber||"",onChange:t=>i({...s,phoneNumber:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):a.phoneNumber?e.jsx("a",{href:`tel:${a.phoneNumber.replace(/\s/g,"")}`,onClick:t=>{if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){t.preventDefault();const C=`BEGIN:VCARD
VERSION:3.0
FN:${a.firstName} ${a.lastName}
N:${a.lastName};${a.firstName};;;
TEL:${a.phoneNumber.replace(/\s/g,"")}
EMAIL:${a.email||""}
END:VCARD`,S=new Blob([C],{type:"text/vcard"}),$=URL.createObjectURL(S),x=document.createElement("a");x.href=$,x.download=`${a.firstName}_${a.lastName}.vcf`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL($)}},className:"text-blue-600 hover:text-blue-800 underline cursor-pointer touch-manipulation",children:a.phoneNumber}):e.jsx("div",{className:"text-gray-900",children:"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),l?e.jsx("input",{type:"email",value:s.email||"",onChange:t=>i({...s,email:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"}):a.email?e.jsx("a",{href:`mailto:${a.email}`,className:"text-blue-600 hover:text-blue-800 underline cursor-pointer touch-manipulation",children:a.email}):e.jsx("div",{className:"text-gray-900",children:"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contracted"}),l?e.jsxs("select",{value:s.contracted||"N",onChange:t=>i({...s,contracted:t.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"Y",children:"Y"}),e.jsx("option",{value:"N",children:"N"})]}):e.jsx("div",{className:"text-gray-900",children:a.contracted||"N"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unexcused Absences"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"PT (Physical Training):"}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsx("div",{onClick:async()=>{if(h>0)if(c==="PT")d(null),m([]);else{const t=await E(o,"PT");m(t),d("PT")}},className:`text-gray-900 font-semibold ${h>0?"cursor-pointer hover:text-blue-600 underline":""}`,children:h}),c==="PT"&&u.length>0&&e.jsxs("div",{className:"absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-white text-gray-900 text-xs rounded-lg shadow-lg border border-gray-300 p-3 max-h-64 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold mb-2 text-gray-900",children:"Unexcused PT Dates:"}),e.jsx("div",{className:"space-y-1",children:u.map((t,r)=>e.jsx("div",{className:"text-gray-700",children:k(t)},r))}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Lab:"}),e.jsxs("div",{className:"relative",ref:N,children:[e.jsx("div",{onClick:async()=>{if(b>0)if(c==="Lab")d(null),m([]);else{const t=await E(o,"Lab");m(t),d("Lab")}},className:`text-gray-900 font-semibold ${b>0?"cursor-pointer hover:text-blue-600 underline":""}`,children:b}),c==="Lab"&&u.length>0&&e.jsxs("div",{className:"absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-white text-gray-900 text-xs rounded-lg shadow-lg border border-gray-300 p-3 max-h-64 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold mb-2 text-gray-900",children:"Unexcused Lab Dates:"}),e.jsx("div",{className:"space-y-1",children:u.map((t,r)=>e.jsx("div",{className:"text-gray-700",children:k(t)},r))}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tactics:"}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("div",{onClick:async()=>{if(f>0)if(c==="Tactics")d(null),m([]);else{const t=await E(o,"Tactics");m(t),d("Tactics")}},className:`text-gray-900 font-semibold ${f>0?"cursor-pointer hover:text-blue-600 underline":""}`,children:f}),c==="Tactics"&&u.length>0&&e.jsxs("div",{className:"absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 bg-white text-gray-900 text-xs rounded-lg shadow-lg border border-gray-300 p-3 max-h-64 overflow-y-auto",children:[e.jsx("div",{className:"font-semibold mb-2 text-gray-900",children:"Unexcused Tactics Dates:"}),e.jsx("div",{className:"space-y-1",children:u.map((t,r)=>e.jsx("div",{className:"text-gray-700",children:k(t)},r))}),e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:h>0||b>0||f>0?"Click on a number to see specific dates":"These are calculated automatically from attendance records"})]})]}),l&&e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:O,disabled:p,className:`flex-1 py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${p?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:p?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{y(!1),w()},className:"flex-1 py-3 px-4 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 active:bg-gray-400 touch-manipulation min-h-[44px]",children:"Cancel"})]}),!l&&e.jsx("button",{onClick:_,className:"w-full mt-4 py-3 px-4 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700 active:bg-red-800 touch-manipulation min-h-[44px]",children:"Delete Cadet"})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Cadet not found"})})}export{ee as default};
