import{r as i,j as e}from"./react-vendor-C8iBsMnn.js";import{c as U}from"./cadetService-bh6XJydc.js";import{h as F,a as $,u as B}from"./attendanceService-MnY5YM3z.js";import{g as C,a as P,f as O,c as J,d as T}from"./dates-Da0E0fI-.js";import"./vendor-C6jWcdt9.js";import"./firebase-vendor-u2jlvS72.js";import"./index-D3ls51t0.js";function _({onBack:l,onSelectCadet:d}){const[r,g]=i.useState([]),[x,m]=i.useState(new Map),[c,u]=i.useState(new Map),[M,f]=i.useState(!0),[p,b]=i.useState(!1),[o,S]=i.useState(C()),[q,W]=i.useState(new Map),E=P(o);i.useEffect(()=>{v()},[o]),i.useEffect(()=>{r.length>0&&j()},[r]);async function v(){f(!0);try{const t=await U("MS3");g(t);const a=new Map;for(const n of t){const s=await F(n.id,o),h={cadetId:n.id,ptMonday:(s==null?void 0:s.ptMonday)??null,ptTuesday:(s==null?void 0:s.ptTuesday)??null,ptWednesday:(s==null?void 0:s.ptWednesday)??null,ptThursday:(s==null?void 0:s.ptThursday)??null,ptFriday:(s==null?void 0:s.ptFriday)??null,labThursday:(s==null?void 0:s.labThursday)??null,tacticsTuesday:(s==null?void 0:s.tacticsTuesday)??null,weekStartDate:o};a.set(n.id,h)}m(a),u(new Map(a))}catch(t){console.error("Error loading data:",t),alert(`Error loading data: ${t instanceof Error?t.message:"Unknown error"}`)}finally{f(!1)}}async function j(){try{const t=r.map(n=>n.id),a=await $(t,"Tactics");W(a)}catch(t){console.error("Error loading unexcused totals:",t)}}function A(t,a){u(n=>{const s=new Map(n),R={...s.get(t)||{cadetId:t,ptMonday:null,ptTuesday:null,ptWednesday:null,ptThursday:null,ptFriday:null,labThursday:null,tacticsTuesday:null,weekStartDate:o},tacticsTuesday:a||null,weekStartDate:o};return s.set(t,R),s})}async function D(){b(!0);try{const t=[];c.forEach((a,n)=>{const s=x.get(n);a.tacticsTuesday!==((s==null?void 0:s.tacticsTuesday)??null)&&t.push({cadetId:n,record:a})}),x.forEach((a,n)=>{if(!c.has(n)){const s={cadetId:n,weekStartDate:o,ptMonday:null,ptTuesday:null,ptWednesday:null,ptThursday:null,ptFriday:null,labThursday:null,tacticsTuesday:null};t.push({cadetId:n,record:s})}}),await Promise.all(t.map(({record:a})=>B(a))),m(new Map(c)),await j(),alert("Attendance saved successfully!")}catch(t){console.error("Error saving attendance:",t),alert(`Error saving attendance: ${t instanceof Error?t.message:"Unknown error"}`),await v()}finally{b(!1)}}const y=JSON.stringify(Array.from(x.entries()).sort())!==JSON.stringify(Array.from(c.entries()).sort()),L=Array.from(c.values());let N=0,w=0,k=0;return L.forEach(t=>{t.tacticsTuesday==="present"?N++:t.tacticsTuesday==="excused"?w++:t.tacticsTuesday==="unexcused"&&k++}),M?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-safe-area-inset-bottom",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 safe-area-inset-top",children:e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Tactics Attendance"}),e.jsx("button",{onClick:l,className:"text-sm text-blue-600 font-medium touch-manipulation",style:{minHeight:"44px",minWidth:"44px"},children:"Back"})]})}),e.jsxs("main",{className:"px-4 py-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"grid gap-2 text-center grid-cols-2",children:[e.jsx("div",{className:"font-semibold text-gray-700",children:"Name"}),e.jsx("div",{className:"font-semibold text-gray-700 text-sm",children:O(E.tuesday)})]})}),e.jsx("div",{className:"space-y-2",children:r.map(t=>{const a=c.get(t.id),n=(a==null?void 0:a.tacticsTuesday)??null;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"grid gap-2 p-3 grid-cols-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{onClick:()=>d==null?void 0:d(t.id),className:"font-medium text-blue-600 hover:text-blue-800 text-sm text-left touch-manipulation",children:[t.lastName,", ",t.firstName]})}),e.jsxs("select",{value:n||"",onChange:s=>{const h=s.target.value;A(t.id,h===""?null:h)},"aria-label":`${t.firstName} ${t.lastName} Tuesday Tactics attendance`,className:`border-2 rounded-md px-2 py-2 text-sm font-medium touch-manipulation min-h-[44px] bg-white ${z(n)} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[e.jsx("option",{value:"",children:"â€”"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"excused",children:"Excused"}),e.jsx("option",{value:"unexcused",children:"Unexcused"})]})]})},t.id)})}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No MS3 cadets found"}),r.length>0&&e.jsx("div",{className:"mt-4 mb-4",children:e.jsx("button",{onClick:D,disabled:!y||p,className:`w-full py-3 px-4 rounded-lg font-semibold text-white touch-manipulation min-h-[44px] ${y&&!p?"bg-blue-600 hover:bg-blue-700 active:bg-blue-800":"bg-gray-400 cursor-not-allowed"}`,children:p?"Saving...":y?"Save Changes":"All Changes Saved"})}),r.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-present",children:N}),e.jsx("div",{className:"text-xs text-gray-600",children:"Present"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-excused",children:w}),e.jsx("div",{className:"text-xs text-gray-600",children:"Excused"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-unexcused",children:k}),e.jsx("div",{className:"text-xs text-gray-600",children:"Unexcused"})]})]})]}),r.length>0&&e.jsx(H,{currentWeekStart:o,onWeekChange:S})]})]})}function z(l){return l==="present"?"border-present text-present":l==="excused"?"border-excused text-excused":l==="unexcused"?"border-unexcused text-unexcused":"border-gray-300 text-gray-600"}function H({currentWeekStart:l,onWeekChange:d}){const r=C();function g(){const u=T(l,-1);d(u)}function x(){const u=T(l,1);d(u)}function m(){d(r)}const c=l===r;return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:g,className:"flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 hover:bg-gray-50 active:bg-gray-100 touch-manipulation transition-colors","aria-label":"Previous week",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 text-center px-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Week of ",J(l)]}),!c&&e.jsx("button",{onClick:m,className:"text-xs text-blue-600 hover:text-blue-700 mt-1 touch-manipulation",children:"Return to Current Week"})]}),e.jsx("button",{onClick:x,className:"flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 hover:bg-gray-50 active:bg-gray-100 touch-manipulation transition-colors","aria-label":"Next week",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})}export{_ as default};
